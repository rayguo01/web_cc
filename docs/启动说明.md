# Web Claude Code 启动说明

## 前置条件

### 1. 安装 Node.js

需要 Node.js 18 或更高版本。

```bash
# Ubuntu
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node --version
npm --version
```

### 2. 安装 Claude Code CLI

#### 方式一：原生安装（推荐）

**Linux/WSL:**
```bash
curl -fsSL https://claude.ai/install.sh | bash
```

**Windows PowerShell:**
```powershell
irm https://claude.ai/install.ps1 | iex
```

#### 方式二：NPM 安装

```bash
# 注意：不要使用 sudo
npm install -g @anthropic-ai/claude-code

# 验证安装
claude --version
```

### 3. 配置 Claude 账户认证

Claude Code 需要有效的 Anthropic 账户才能运行。

#### 方式一：OAuth 登录（推荐）

```bash
# 启动登录流程
claude login

# 会打开浏览器，使用以下账户类型登录：
# - Claude Pro ($20/月)
# - Claude Max ($100/月)
# - Anthropic Console 账户（API 付费）
```

#### 方式二：API Key 方式

1. 访问 [Anthropic Console](https://console.anthropic.com/) 获取 API Key
2. 设置环境变量：

```bash
# 临时设置
export ANTHROPIC_API_KEY="your-api-key-here"

# 永久设置（添加到 ~/.bashrc 或 ~/.zshrc）
echo 'export ANTHROPIC_API_KEY="your-api-key-here"' >> ~/.bashrc
source ~/.bashrc
```

#### 检查认证状态

```bash
# 检查登录状态
claude auth status

# 检查安装是否正常
claude doctor
```

---

## 启动 Web Claude Code

### 1. 进入项目目录

```bash
cd /path/to/web-cc
```

### 2. 安装依赖（首次运行）

```bash
npm install
```

### 3. 配置环境变量

确认 `.env` 文件配置正确：

```bash
# .env 文件内容
DATABASE_URL=postgresql://...  # Neon 数据库连接串
JWT_SECRET=your-secret-key     # JWT 密钥（生产环境请修改）
PORT=3000                      # 服务端口
```

### 4. 启动服务器

```bash
# 生产模式
npm start

# 开发模式（支持热重载）
npm run dev
```

### 5. 访问应用

打开浏览器访问：http://localhost:3000

---

## 常见问题

### Claude CLI 命令无法找到

```bash
# 检查是否在 PATH 中
which claude

# 如果没有，手动添加到 PATH
export PATH="$HOME/.claude/bin:$PATH"
```

### 认证失败

```bash
# 重新登录
claude logout
claude login

# 或检查 API Key
echo $ANTHROPIC_API_KEY
```

### 数据库连接失败

1. 确认网络能访问 Neon 数据库
2. 检查 DATABASE_URL 格式是否正确
3. 确认数据库服务正常运行

### WebSocket 连接失败

1. 确认服务器已启动
2. 检查防火墙设置
3. 确认端口未被占用：`lsof -i :3000`

---

## 服务器部署（Ubuntu）

### 使用 PM2 守护进程

```bash
# 安装 PM2
npm install -g pm2

# 启动应用
pm2 start src/server.js --name web-cc

# 开机自启
pm2 startup
pm2 save

# 查看日志
pm2 logs web-cc
```

### 使用 systemd

创建服务文件 `/etc/systemd/system/web-cc.service`:

```ini
[Unit]
Description=Web Claude Code
After=network.target

[Service]
Type=simple
User=your-username
WorkingDirectory=/path/to/web-cc
ExecStart=/usr/bin/node src/server.js
Restart=on-failure
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
```

启动服务：

```bash
sudo systemctl daemon-reload
sudo systemctl enable web-cc
sudo systemctl start web-cc
sudo systemctl status web-cc
```

---

## 参考资料

- [Claude Code 官方文档](https://code.claude.com/docs/en/setup)
- [Claude Code NPM 包](https://www.npmjs.com/package/@anthropic-ai/claude-code)
- [Anthropic Console](https://console.anthropic.com/)
